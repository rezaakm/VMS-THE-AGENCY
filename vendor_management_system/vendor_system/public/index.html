<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Agency - Vendor Management & RFQ System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f0f14;
            --bg-card: #1a1a24;
            --bg-elevated: #242432;
            --bg-input: #2a2a3a;
            --accent: #00d4ff;
            --accent-green: #00ff88;
            --accent-orange: #ff6b35;
            --accent-magenta: #ff00aa;
            --text-primary: #ffffff;
            --text-secondary: #9999aa;
            --text-muted: #666677;
            --border: #333344;
            --success: #00ff88;
            --warning: #ffaa00;
            --error: #ff4466;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
        }
        
        /* Layout */
        .app { display: flex; min-height: 100vh; }
        
        .sidebar {
            width: 260px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .main { flex: 1; margin-left: 260px; padding: 30px; }
        
        /* Sidebar */
        .logo {
            padding: 0 20px 30px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        
        .logo h1 {
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-magenta) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }
        
        .logo span {
            display: block;
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 400;
            margin-top: 2px;
        }
        
        .nav-section {
            padding: 0 15px;
            margin-bottom: 25px;
        }
        
        .nav-section-title {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-muted);
            padding: 0 10px;
            margin-bottom: 10px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .nav-item:hover { background: var(--bg-elevated); color: var(--text-primary); }
        .nav-item.active { background: var(--accent); color: var(--bg-dark); font-weight: 500; }
        
        .nav-icon { font-size: 18px; width: 24px; text-align: center; }
        
        .nav-badge {
            margin-left: auto;
            background: var(--accent);
            color: var(--bg-dark);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }
        
        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 700;
        }
        
        .page-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 5px;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--accent);
            color: var(--bg-dark);
        }
        
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0, 212, 255, 0.3); }
        
        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover { border-color: var(--accent); }
        
        .btn-success { background: var(--success); color: var(--bg-dark); }
        .btn-danger { background: var(--error); color: white; }
        .btn-sm { padding: 8px 14px; font-size: 13px; }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--accent);
        }
        
        .stat-card.green::before { background: var(--accent-green); }
        .stat-card.orange::before { background: var(--accent-orange); }
        .stat-card.magenta::before { background: var(--accent-magenta); }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .stat-change {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        /* Tables */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 15px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
            background: var(--bg-elevated);
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }
        
        tr:hover td { background: var(--bg-elevated); }
        
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-active { background: rgba(0, 255, 136, 0.15); color: var(--success); }
        .status-pending { background: rgba(255, 170, 0, 0.15); color: var(--warning); }
        .status-draft { background: rgba(102, 102, 119, 0.3); color: var(--text-secondary); }
        .status-sent { background: rgba(0, 212, 255, 0.15); color: var(--accent); }
        .status-awarded { background: rgba(0, 255, 136, 0.15); color: var(--success); }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }
        
        .form-textarea { min-height: 100px; resize: vertical; }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal-overlay.active { opacity: 1; visibility: visible; }
        
        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: all 0.3s;
        }
        
        .modal-overlay.active .modal { transform: translateY(0); }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title { font-size: 20px; font-weight: 600; }
        
        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: none;
            background: var(--bg-elevated);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
        }
        
        .modal-body { padding: 25px; }
        .modal-footer { padding: 20px 25px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 10px; }
        
        /* Search */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 14px 20px 14px 50px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
        }
        
        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }
        
        /* Filter Bar */
        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-chip {
            padding: 8px 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-chip:hover, .filter-chip.active {
            background: var(--accent);
            color: var(--bg-dark);
            border-color: var(--accent);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 2000;
        }
        
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--error); }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state-icon { font-size: 48px; margin-bottom: 20px; opacity: 0.5; }
        .empty-state-title { font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 10px; }
        
        /* Vendor Card */
        .vendor-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--bg-elevated);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .vendor-card:hover { transform: translateX(5px); border-left: 3px solid var(--accent); }
        
        .vendor-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent), var(--accent-magenta));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
        }
        
        .vendor-info { flex: 1; }
        .vendor-name { font-weight: 600; margin-bottom: 3px; }
        .vendor-category { font-size: 13px; color: var(--text-secondary); }
        
        /* Quote Comparison */
        .quote-card {
            background: var(--bg-elevated);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s;
        }
        
        .quote-card:hover { border-color: var(--accent); }
        .quote-card.selected { border-color: var(--success); background: rgba(0, 255, 136, 0.05); }
        
        .quote-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .quote-vendor { font-weight: 600; font-size: 16px; }
        .quote-amount { font-size: 24px; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--accent); }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            background: var(--bg-elevated);
            padding: 5px;
            border-radius: 12px;
            margin-bottom: 25px;
        }
        
        .tab {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }
        
        .tab:hover { color: var(--text-primary); }
        .tab.active { background: var(--accent); color: var(--bg-dark); }
        
        /* Hidden */
        .hidden { display: none !important; }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in { animation: fadeIn 0.3s ease forwards; }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1>
                    <div class="logo-icon">TA</div>
                    The Agency
                </h1>
                <span>Vendor Management System</span>
            </div>
            
            <nav class="nav-section">
                <div class="nav-section-title">Overview</div>
                <div class="nav-item active" data-page="dashboard">
                    <span class="nav-icon">üìä</span>
                    Dashboard
                </div>
            </nav>
            
            <nav class="nav-section">
                <div class="nav-section-title">Procurement</div>
                <div class="nav-item" data-page="vendors">
                    <span class="nav-icon">üè¢</span>
                    Vendors
                    <span class="nav-badge" id="vendor-count">0</span>
                </div>
                <div class="nav-item" data-page="rfqs">
                    <span class="nav-icon">üìã</span>
                    RFQs
                    <span class="nav-badge" id="rfq-count">0</span>
                </div>
                <div class="nav-item" data-page="quotes">
                    <span class="nav-icon">üí∞</span>
                    Quotes
                </div>
            </nav>
            
            <nav class="nav-section">
                <div class="nav-section-title">Data</div>
                <div class="nav-item" data-page="projects">
                    <span class="nav-icon">üìÅ</span>
                    Projects
                </div>
                <div class="nav-item" data-page="analytics">
                    <span class="nav-icon">üìà</span>
                    Analytics
                </div>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main">
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Dashboard</h1>
                        <p class="page-subtitle">Overview of your vendor management system</p>
                    </div>
                    <button class="btn btn-primary" onclick="openModal('rfq')">
                        <span>+</span> New RFQ
                    </button>
                </div>
                
                <div class="stats-grid" id="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-label">Total Vendors</div>
                        <div class="stat-value" id="stat-vendors">-</div>
                        <div class="stat-change">Active in database</div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-label">Total Projects</div>
                        <div class="stat-value" id="stat-projects">-</div>
                        <div class="stat-change">Historical records</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-label">Open RFQs</div>
                        <div class="stat-value" id="stat-rfqs">-</div>
                        <div class="stat-change">Awaiting quotes</div>
                    </div>
                    <div class="stat-card magenta">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="stat-revenue">-</div>
                        <div class="stat-change">OMR from projects</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Top Clients</h3>
                        </div>
                        <div id="top-clients"></div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Recent RFQs</h3>
                            <button class="btn btn-secondary btn-sm" onclick="navigate('rfqs')">View All</button>
                        </div>
                        <div id="recent-rfqs"></div>
                    </div>
                </div>
            </div>
            
            <!-- Vendors Page -->
            <div id="page-vendors" class="page hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Vendors</h1>
                        <p class="page-subtitle">Manage your supplier database</p>
                    </div>
                    <button class="btn btn-primary" onclick="openModal('vendor')">
                        <span>+</span> Add Vendor
                    </button>
                </div>
                
                <div class="card">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" placeholder="Search vendors..." id="vendor-search" oninput="filterVendors()">
                    </div>
                    
                    <div class="filter-bar" id="category-filters"></div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Vendor</th>
                                    <th>Category</th>
                                    <th>Contact</th>
                                    <th>Projects</th>
                                    <th>Total Spent</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="vendors-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- RFQs Page -->
            <div id="page-rfqs" class="page hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">RFQs</h1>
                        <p class="page-subtitle">Request for Quotations</p>
                    </div>
                    <button class="btn btn-primary" onclick="openModal('rfq')">
                        <span>+</span> Create RFQ
                    </button>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-status="">All</div>
                    <div class="tab" data-status="Draft">Draft</div>
                    <div class="tab" data-status="Sent">Sent</div>
                    <div class="tab" data-status="Awarded">Awarded</div>
                </div>
                
                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>RFQ #</th>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Deadline</th>
                                    <th>Vendors</th>
                                    <th>Quotes</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="rfqs-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Quotes Page -->
            <div id="page-quotes" class="page hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Quote Comparison</h1>
                        <p class="page-subtitle">Compare and select vendor quotes</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="form-group">
                        <label class="form-label">Select RFQ</label>
                        <select class="form-select" id="quote-rfq-select" onchange="loadQuotesForRfq()">
                            <option value="">Choose an RFQ...</option>
                        </select>
                    </div>
                    
                    <div id="quotes-comparison"></div>
                </div>
            </div>
            
            <!-- Projects Page -->
            <div id="page-projects" class="page hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Projects</h1>
                        <p class="page-subtitle">Historical project data from cost sheets</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" placeholder="Search by client or project..." id="project-search" oninput="filterProjects()">
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Project #</th>
                                    <th>Client</th>
                                    <th>Subject</th>
                                    <th>Year</th>
                                    <th>Cost</th>
                                    <th>Price</th>
                                    <th>Margin</th>
                                </tr>
                            </thead>
                            <tbody id="projects-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Analytics Page -->
            <div id="page-analytics" class="page hidden">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Analytics</h1>
                        <p class="page-subtitle">Business intelligence and insights</p>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Avg Project Margin</div>
                        <div class="stat-value" id="stat-avg-margin">-</div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-label">Total Cost Base</div>
                        <div class="stat-value" id="stat-total-cost">-</div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-label">Vendor Categories</div>
                        <div class="stat-value">12</div>
                    </div>
                    <div class="stat-card magenta">
                        <div class="stat-label">Avg Quote Response</div>
                        <div class="stat-value">24h</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Revenue by Year</h3>
                        </div>
                        <div id="revenue-by-year"></div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Vendors by Category</h3>
                        </div>
                        <div id="vendors-by-category"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Vendor Modal -->
    <div class="modal-overlay" id="vendor-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Add Vendor</h2>
                <button class="modal-close" onclick="closeModal('vendor')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="vendor-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Company Name *</label>
                            <input type="text" class="form-input" name="company_name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Trade Name</label>
                            <input type="text" class="form-input" name="trade_name">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Category *</label>
                            <select class="form-select" name="category" required id="vendor-category-select"></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contact Name</label>
                            <input type="text" class="form-input" name="contact_name">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-input" name="phone">
                        </div>
                        <div class="form-group">
                            <label class="form-label">WhatsApp</label>
                            <input type="tel" class="form-input" name="whatsapp">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" name="email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Terms</label>
                        <select class="form-select" name="payment_terms">
                            <option value="NET30">NET 30</option>
                            <option value="NET60">NET 60</option>
                            <option value="COD">Cash on Delivery</option>
                            <option value="Advance">Advance Payment</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea class="form-textarea" name="notes"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('vendor')">Cancel</button>
                <button class="btn btn-primary" onclick="saveVendor()">Save Vendor</button>
            </div>
        </div>
    </div>
    
    <!-- RFQ Modal -->
    <div class="modal-overlay" id="rfq-modal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">Create RFQ</h2>
                <button class="modal-close" onclick="closeModal('rfq')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="rfq-form">
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" class="form-input" name="title" placeholder="e.g., Stage Production for Ferrari Launch" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Category *</label>
                            <select class="form-select" name="category" required id="rfq-category-select" onchange="suggestVendors()"></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quantity</label>
                            <input type="number" class="form-input" name="quantity" value="1" min="1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Quote Deadline</label>
                            <input type="datetime-local" class="form-input" name="deadline">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Delivery Date</label>
                            <input type="date" class="form-input" name="delivery_date">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Specifications</label>
                        <textarea class="form-textarea" name="specifications" placeholder="Detailed requirements, dimensions, materials, etc."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Select Vendors</label>
                        <div id="rfq-vendor-list" style="max-height: 200px; overflow-y: auto;"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('rfq')">Cancel</button>
                <button class="btn btn-primary" onclick="saveRfq()">Create RFQ</button>
            </div>
        </div>
    </div>
    
    <!-- Quote Modal -->
    <div class="modal-overlay" id="quote-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Add Quote</h2>
                <button class="modal-close" onclick="closeModal('quote')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="quote-form">
                    <input type="hidden" name="rfq_id" id="quote-rfq-id">
                    <div class="form-group">
                        <label class="form-label">Vendor *</label>
                        <select class="form-select" name="vendor_id" required id="quote-vendor-select"></select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Amount (OMR) *</label>
                            <input type="number" class="form-input" name="amount" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Validity (Days)</label>
                            <input type="number" class="form-input" name="validity_days" value="30">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea class="form-textarea" name="notes"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('quote')">Cancel</button>
                <button class="btn btn-primary" onclick="saveQuote()">Save Quote</button>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast">
        <span id="toast-message"></span>
    </div>
    
    <script>
        const API = '';
        let categories = [];
        let vendors = [];
        let currentCategoryFilter = '';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadCategories();
            loadDashboard();
            
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => navigate(item.dataset.page));
            });
            
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    loadRfqs(tab.dataset.status);
                });
            });
        });
        
        // Navigation
        function navigate(page) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(`page-${page}`).classList.remove('hidden');
            
            // Load page data
            switch(page) {
                case 'dashboard': loadDashboard(); break;
                case 'vendors': loadVendors(); break;
                case 'rfqs': loadRfqs(); break;
                case 'projects': loadProjects(); break;
                case 'quotes': loadQuotesPage(); break;
                case 'analytics': loadAnalytics(); break;
            }
        }
        
        // API Calls
        async function api(endpoint, options = {}) {
            const res = await fetch(API + endpoint, {
                headers: { 'Content-Type': 'application/json' },
                ...options,
                body: options.body ? JSON.stringify(options.body) : undefined
            });
            return res.json();
        }
        
        // Load Data Functions
        async function loadCategories() {
            categories = await api('/api/categories');
            const options = categories.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
            document.getElementById('vendor-category-select').innerHTML = options;
            document.getElementById('rfq-category-select').innerHTML = options;
            
            // Category filters
            document.getElementById('category-filters').innerHTML = 
                `<div class="filter-chip active" onclick="filterByCategory('')">All</div>` +
                categories.map(c => `<div class="filter-chip" onclick="filterByCategory('${c.name}')">${c.name}</div>`).join('');
        }
        
        async function loadDashboard() {
            const data = await api('/api/analytics/dashboard');
            
            document.getElementById('stat-vendors').textContent = data.vendors.total;
            document.getElementById('stat-projects').textContent = data.projects.total;
            document.getElementById('stat-rfqs').textContent = data.rfqs.sent || 0;
            document.getElementById('stat-revenue').textContent = formatCurrency(data.projects.total_revenue);
            
            document.getElementById('vendor-count').textContent = data.vendors.total;
            document.getElementById('rfq-count').textContent = data.rfqs.total;
            
            // Top clients
            document.getElementById('top-clients').innerHTML = data.top_clients.slice(0, 5).map(c => `
                <div class="vendor-card">
                    <div class="vendor-avatar">${c.client.substring(0, 2).toUpperCase()}</div>
                    <div class="vendor-info">
                        <div class="vendor-name">${c.client}</div>
                        <div class="vendor-category">${c.projects} projects</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 600; font-family: 'JetBrains Mono';">${formatCurrency(c.revenue)}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">Revenue</div>
                    </div>
                </div>
            `).join('');
            
            // Recent RFQs
            const rfqs = await api('/api/rfqs');
            document.getElementById('recent-rfqs').innerHTML = rfqs.length > 0 
                ? rfqs.slice(0, 5).map(r => `
                    <div class="vendor-card" onclick="viewRfq('${r.id}')">
                        <div class="vendor-avatar">üìã</div>
                        <div class="vendor-info">
                            <div class="vendor-name">${r.rfq_number}</div>
                            <div class="vendor-category">${r.title}</div>
                        </div>
                        <span class="status-badge status-${r.status.toLowerCase()}">${r.status}</span>
                    </div>
                `).join('')
                : '<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-title">No RFQs yet</div><p>Create your first RFQ to get started</p></div>';
        }
        
        async function loadVendors() {
            const search = document.getElementById('vendor-search')?.value || '';
            const url = `/api/vendors?search=${search}${currentCategoryFilter ? '&category=' + currentCategoryFilter : ''}`;
            vendors = await api(url);
            
            document.getElementById('vendors-table').innerHTML = vendors.map(v => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div class="vendor-avatar" style="width: 40px; height: 40px; font-size: 14px;">
                                ${v.company_name.substring(0, 2).toUpperCase()}
                            </div>
                            <div>
                                <div style="font-weight: 500;">${v.company_name}</div>
                                ${v.contact_name ? `<div style="font-size: 12px; color: var(--text-secondary);">${v.contact_name}</div>` : ''}
                            </div>
                        </div>
                    </td>
                    <td>${v.category || '-'}</td>
                    <td>${v.phone || v.whatsapp || v.email || '-'}</td>
                    <td>${v.projects_count || 0}</td>
                    <td style="font-family: 'JetBrains Mono';">${v.total_spent ? formatCurrency(v.total_spent) : '-'}</td>
                    <td><span class="status-badge status-${v.status.toLowerCase()}">${v.status}</span></td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="editVendor('${v.id}')">Edit</button>
                    </td>
                </tr>
            `).join('');
        }
        
        function filterVendors() {
            loadVendors();
        }
        
        function filterByCategory(category) {
            currentCategoryFilter = category;
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            loadVendors();
        }
        
        async function loadRfqs(status = '') {
            const url = `/api/rfqs${status ? '?status=' + status : ''}`;
            const rfqs = await api(url);
            
            document.getElementById('rfqs-table').innerHTML = rfqs.length > 0 
                ? rfqs.map(r => `
                    <tr>
                        <td><strong>${r.rfq_number}</strong></td>
                        <td>${r.title}</td>
                        <td>${r.category || '-'}</td>
                        <td>${r.deadline ? new Date(r.deadline).toLocaleDateString() : '-'}</td>
                        <td>${r.vendors_count || 0}</td>
                        <td>${r.quotes_count || 0}</td>
                        <td><span class="status-badge status-${r.status.toLowerCase()}">${r.status}</span></td>
                        <td>
                            <button class="btn btn-secondary btn-sm" onclick="viewRfq('${r.id}')" style="margin-right: 5px;">View</button>
                            ${r.status === 'Draft' ? `<button class="btn btn-primary btn-sm" onclick="sendRfq('${r.id}')">Send</button>` : ''}
                            ${r.status === 'Sent' ? `<button class="btn btn-success btn-sm" onclick="addQuoteForRfq('${r.id}')">Add Quote</button>` : ''}
                        </td>
                    </tr>
                `).join('')
                : '<tr><td colspan="8" class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-title">No RFQs</div></td></tr>';
        }
        
        async function loadProjects() {
            const search = document.getElementById('project-search')?.value || '';
            const projects = await api(`/api/projects?client=${search}`);
            
            document.getElementById('projects-table').innerHTML = projects.map(p => `
                <tr>
                    <td><strong>${p.project_number || '-'}</strong></td>
                    <td>${p.client}</td>
                    <td style="max-width: 250px; overflow: hidden; text-overflow: ellipsis;">${p.subject || '-'}</td>
                    <td>${p.year}</td>
                    <td style="font-family: 'JetBrains Mono';">${formatCurrency(p.total_cost)}</td>
                    <td style="font-family: 'JetBrains Mono';">${formatCurrency(p.total_price)}</td>
                    <td style="font-family: 'JetBrains Mono'; color: ${p.margin > 0 ? 'var(--success)' : 'var(--text-secondary)'}">
                        ${formatCurrency(p.margin)} (${p.margin_pct?.toFixed(1) || 0}%)
                    </td>
                </tr>
            `).join('');
        }
        
        function filterProjects() {
            loadProjects();
        }
        
        async function loadQuotesPage() {
            const rfqs = await api('/api/rfqs?status=Sent');
            document.getElementById('quote-rfq-select').innerHTML = 
                '<option value="">Choose an RFQ...</option>' +
                rfqs.map(r => `<option value="${r.id}">${r.rfq_number} - ${r.title}</option>`).join('');
        }
        
        async function loadQuotesForRfq() {
            const rfqId = document.getElementById('quote-rfq-select').value;
            if (!rfqId) {
                document.getElementById('quotes-comparison').innerHTML = '';
                return;
            }
            
            const rfq = await api(`/api/rfqs/${rfqId}`);
            
            if (rfq.quotes.length === 0) {
                document.getElementById('quotes-comparison').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí∞</div>
                        <div class="empty-state-title">No quotes yet</div>
                        <p>Waiting for vendor responses</p>
                        <button class="btn btn-primary" onclick="addQuoteForRfq('${rfqId}')" style="margin-top: 15px;">Add Quote</button>
                    </div>
                `;
                return;
            }
            
            const lowestQuote = Math.min(...rfq.quotes.map(q => q.amount));
            
            document.getElementById('quotes-comparison').innerHTML = `
                <div style="margin-bottom: 20px; padding: 15px; background: var(--bg-elevated); border-radius: 12px;">
                    <strong>${rfq.title}</strong><br>
                    <span style="color: var(--text-secondary);">${rfq.category} ¬∑ ${rfq.quotes.length} quotes received</span>
                </div>
                ${rfq.quotes.map(q => `
                    <div class="quote-card ${q.status === 'Accepted' ? 'selected' : ''}">
                        <div class="quote-header">
                            <div class="quote-vendor">${q.vendor_name}</div>
                            <div class="quote-amount">OMR ${q.amount.toFixed(2)}</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                ${q.amount === lowestQuote ? '<span class="status-badge status-active">Lowest Quote</span>' : ''}
                                <span style="color: var(--text-secondary); font-size: 13px;">Valid for ${q.validity_days} days</span>
                            </div>
                            ${q.status === 'Pending' ? `
                                <button class="btn btn-success btn-sm" onclick="acceptQuote('${q.id}')">Accept Quote</button>
                            ` : q.status === 'Accepted' ? `
                                <span class="status-badge status-awarded">‚úì Accepted</span>
                            ` : `
                                <span class="status-badge status-draft">Rejected</span>
                            `}
                        </div>
                    </div>
                `).join('')}
                <button class="btn btn-secondary" onclick="addQuoteForRfq('${rfqId}')" style="margin-top: 10px;">+ Add Another Quote</button>
            `;
        }
        
        async function loadAnalytics() {
            const data = await api('/api/analytics/dashboard');
            
            const totalMargin = data.projects.by_year.reduce((sum, y) => sum + (y.margin || 0), 0);
            const avgMargin = data.projects.total_revenue > 0 ? (totalMargin / data.projects.total_revenue * 100) : 0;
            
            document.getElementById('stat-avg-margin').textContent = avgMargin.toFixed(1) + '%';
            document.getElementById('stat-total-cost').textContent = formatCurrency(data.projects.total_cost);
            
            // Revenue by year
            document.getElementById('revenue-by-year').innerHTML = data.projects.by_year.map(y => `
                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <span><strong>${y.year}</strong> (${y.count} projects)</span>
                    <span style="font-family: 'JetBrains Mono';">${formatCurrency(y.revenue)}</span>
                </div>
            `).join('');
            
            // Vendors by category
            document.getElementById('vendors-by-category').innerHTML = data.vendors.by_category.map(c => `
                <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <span>${c.category || 'Uncategorized'}</span>
                    <span class="status-badge status-sent">${c.count}</span>
                </div>
            `).join('');
        }
        
        // Suggest vendors for RFQ
        async function suggestVendors() {
            const category = document.getElementById('rfq-category-select').value;
            const suggested = await api(`/api/suggest-vendors?category=${category}&limit=10`);
            const all = await api(`/api/vendors?category=${category}`);
            
            document.getElementById('rfq-vendor-list').innerHTML = all.map(v => `
                <label style="display: flex; align-items: center; gap: 10px; padding: 10px; cursor: pointer;">
                    <input type="checkbox" name="vendor_ids" value="${v.id}" ${suggested.find(s => s.id === v.id) ? 'checked' : ''}>
                    <div class="vendor-avatar" style="width: 32px; height: 32px; font-size: 12px;">
                        ${v.company_name.substring(0, 2).toUpperCase()}
                    </div>
                    <div>
                        <div style="font-weight: 500;">${v.company_name}</div>
                        <div style="font-size: 11px; color: var(--text-secondary);">
                            ${v.projects_count} projects ¬∑ ${v.phone || v.whatsapp || 'No contact'}
                        </div>
                    </div>
                </label>
            `).join('') || '<p style="color: var(--text-secondary); padding: 10px;">No vendors in this category</p>';
        }
        
        // Modal Functions
        function openModal(type) {
            document.getElementById(`${type}-modal`).classList.add('active');
            if (type === 'rfq') suggestVendors();
        }
        
        function closeModal(type) {
            document.getElementById(`${type}-modal`).classList.remove('active');
            document.getElementById(`${type}-form`).reset();
        }
        
        // Save Functions
        async function saveVendor() {
            const form = document.getElementById('vendor-form');
            const data = Object.fromEntries(new FormData(form));
            
            await api('/api/vendors', { method: 'POST', body: data });
            closeModal('vendor');
            showToast('Vendor added successfully!', 'success');
            loadVendors();
            loadDashboard();
        }
        
        async function saveRfq() {
            const form = document.getElementById('rfq-form');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            // Get selected vendors
            data.vendor_ids = Array.from(document.querySelectorAll('input[name="vendor_ids"]:checked')).map(cb => cb.value);
            
            await api('/api/rfqs', { method: 'POST', body: data });
            closeModal('rfq');
            showToast('RFQ created successfully!', 'success');
            loadRfqs();
            loadDashboard();
        }
        
        async function sendRfq(id) {
            if (!confirm('Send this RFQ to selected vendors?')) return;
            
            const result = await api(`/api/rfqs/${id}/send`, { method: 'POST' });
            showToast(`RFQ sent to ${result.vendors_notified} vendors!`, 'success');
            loadRfqs();
        }
        
        function addQuoteForRfq(rfqId) {
            document.getElementById('quote-rfq-id').value = rfqId;
            
            // Load vendors for this RFQ
            api(`/api/rfqs/${rfqId}`).then(rfq => {
                document.getElementById('quote-vendor-select').innerHTML = 
                    rfq.vendors.map(v => `<option value="${v.id}">${v.company_name}</option>`).join('');
            });
            
            openModal('quote');
        }
        
        async function saveQuote() {
            const form = document.getElementById('quote-form');
            const data = Object.fromEntries(new FormData(form));
            
            await api('/api/quotes', { method: 'POST', body: data });
            closeModal('quote');
            showToast('Quote added successfully!', 'success');
            loadRfqs();
            loadQuotesForRfq();
        }
        
        async function acceptQuote(quoteId) {
            if (!confirm('Accept this quote and reject others?')) return;
            
            await api(`/api/quotes/${quoteId}/accept`, { method: 'PUT' });
            showToast('Quote accepted!', 'success');
            loadQuotesForRfq();
            loadRfqs();
        }
        
        async function viewRfq(id) {
            // For now, navigate to quotes page and select this RFQ
            navigate('quotes');
            setTimeout(async () => {
                document.getElementById('quote-rfq-select').value = id;
                loadQuotesForRfq();
            }, 100);
        }
        
        async function editVendor(id) {
            // Could expand to full edit modal - for now just alert
            alert('Edit functionality coming soon!');
        }
        
        // Utilities
        function formatCurrency(value) {
            if (!value || isNaN(value)) return 'OMR 0';
            if (value >= 1000000) return 'OMR ' + (value / 1000000).toFixed(1) + 'M';
            if (value >= 1000) return 'OMR ' + (value / 1000).toFixed(1) + 'K';
            return 'OMR ' + parseFloat(value).toFixed(0);
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
